<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>


</head>
<body bgcolor="#FFFFF0">

<div id="verb_acc_root" >
<script language="Javascript">

var verb_acc={
   sample:"",
   //правильный ответ
   true_ansver:"",
   //всего решалось
   tot_cnt:0  ,
   true_cnt:0,
   error_cnt:0  ,
   start_time:0,
   total_time:0,
   current:0,
   test_count:0,
   sample_fmt:"",

  //Случайное целое в диапазоне
  getRandomArbitrary: function (min, max) {
    return Math.round(Math.random() * (max - min) + min);
  } ,
  //текущий момент - в милисекундах
  Now : function() {
    return (new Date()).getTime();
  },
  // инициализируем див игры
  init:function(){
    this.hideAll();
    $('#verb_acc_div_control').show();
  },
  hideAll:function(){
  alert(1);
    $('#verb_acc_div_control').hide();
  alert(1);
    $('#verb_acc_div_tst').hide();
    $('#verb_acc_check_res').hide();
    $('#verb_acc_totals').hide();
  },
  //начало игры - показываем див игры и результатов
  start:function(){
    this.hideAll();
    $('#verb_acc_div_tst').show();
 
    $('#verb_acc_check_res').show();

     this.tot_cnt=0;
     this.true_cnt=0;
     this.error_cnt=0;
     this.total_time=0;
     this.current=1;
 
     this.test_count=parseInt($('#verb_acc_cnt').val());
     this.sample_fmt=$("#verb_acc_sample_format").val();
     this.genTest();
     $("#verb_acc_check_res").html("");
     $('#verb_acc_totals').html("");
	 
  },


myRand: function (l) {
  switch (l) {
    case 1: return this.getRandomArbitrary(1, 9);
    case 2: return this.getRandomArbitrary(10, 99);
    case 3: return this.getRandomArbitrary(100, 999);
    case 4: return this.getRandomArbitrary(1000, 9999);
    case 5: return this.getRandomArbitrary(10000, 99999);
	}
},  

//Генерируем пример
genTest: function ()
 {
   this.sample="";
   for(i=0;i<this.sample_fmt.length;i++){
     c=this.sample_fmt.charAt(i);
     ind="0123456789".indexOf(""+c);
	 if (ind==-1) {
	   this.sample=this.sample+c;
	 } else {
	   this.sample=this.sample+this.myRand(ind);
	 }
   }


   this.true_ansver=eval(this.sample);
   $('#verb_acc_sample').html(this.sample);    
   $('#verb_acc_answer').val("");
   this.start_time=this.Now();

  
   $('#verb_acc_answer').focus();
},

checkTest: function ()
 {
    var ansver=$('#verb_acc_answer').val();

    cres=$('#verb_acc_check_res');
    cres_html=cres.html();
   this.tot_cnt++;
	
   var calc_time=Math.round((this.Now()-this.start_time)/1000);
   this.total_time+=calc_time;

   var status;
   if (ansver==this.true_ansver) {
     status='OK';
     this.true_cnt++;
   } else {
     status='ERROR';
     this.error_cnt++;
   };    
   
   cres_html+=this.sample+"="+this.true_ansver+" - "+status+" ("+calc_time+" сек)";
   cres_html+='<p>';
   cres.html(cres_html);

   $('#verb_acc_totals').html(
     ' Всего: '+this.tot_cnt+
     ' из: '+this.test_count+
	 ' Правильно: '+this.true_cnt+
	 ' Неправильно: '+this.error_cnt+
	 ' Время полное: '+this.total_time+
	 ' Время среднее: '+Math.round(this.total_time/this.tot_cnt)
    );
	 
	 this.current++;
	 if (this.tot_cnt<this.test_count) {
	   this.genTest();
	   $('#verb_acc_answer').focus();
	 } else {
            this.hideAll();
            $('#verb_acc_div_control').show();
            $('#verb_acc_check_res').show();
            $('#verb_acc_totals').show();
	 }
}


};

//verb_acc.init();
</script>
<h2>Устный счет</h2><p>
<div id="verb_acc_div_control" >
<table>
<tr><td>
<b>Длина серии<b> </td><td>
<select id='verb_acc_cnt'>
<option value='5'>5</option>
<option value='10'>10</option>
<option value='15'>15</option>
<option value='20'>20</option>
</select></td>
</tr>
<tr>
<td><b>Тип примера <b></td><td>
<select id='verb_acc_sample_format'>
<option value='2+2'>## + ##</option>
<option value='2*1'>## * #</option>
<option value='2*2'>## * ##</option>
<option value='3+3'>### + ###</option>
<option value='3*1'>### * #</option>
<option value='3*2'>### * ##</option>
<option value='4+3'>#### + ###</option>
<option value='4*1'>#### * #</option>
</select></td>
</tr>
</table>
<p/>
<input type="button" id="verb_acc_btn_check" value="Начать" onClick="verb_acc.start()">
</div>

<div id="verb_acc_div_tst" style="display:none">
<span id="verb_acc_sample"></span>=<input type="text" id="verb_acc_answer" onkeydown="if (event.keyCode==13) {verb_acc.checkTest();};">
<input type="button" id="verb_acc_btn_check" value="Проверить" onClick="verb_acc.checkTest()"></div>
<div id="verb_acc_check_res"></div><p>
<div id="verb_acc_totals"></div>
</div>
</div>
</div>


</body>
</html>