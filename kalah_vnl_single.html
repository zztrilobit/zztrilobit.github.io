<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>
var Utils={cust_props:function(d){var c={};c.el=d;c.appendTo=function(a){c.el.appendTo(a.el);return c};c.css=function(a){c.el.css(a);return c};c.html=function(a){c.el.html(a);return c};c.click=function(a){c.el.click(a);return c};c.prepend=function(a){c.el.prepend(a.el)};return c},byId:function(d){return this.cust_props($("#"+d))},table:function(d,c){var a=this.tag("table"),b,e,g=[];for(b=0;b<d;b++){var n=this.tag("tr").appendTo(a);g[b]=[];for(e=0;e<c;e++)g[b][e]=this.tag("td").appendTo(n)}a.cells=
g;return a},tag:function(d){d=$("<"+d+"></"+d+">");return this.cust_props(d)}},KalahBoard=function(){var d=function(){this.brd=[];this.bs=0;this.is_tmp=!1},c=d.prototype;c.fill=function(a){var b;for(b=0;b<2*(this.bs+1);b++)a.brd[b]=this.brd[b]};c.doMove=function(a,b){var e;for(e=0;e<b.length;e++)this.moveStep(a,b[e]);return this.gameOver()};c.gameOver=function(){var a,b=[0,0];for(a=0;a<this.bs;a++)b[0]+=this.brd[this.index(0,a)],b[1]+=this.brd[this.index(1,a)];0==b[0]&&(this.brd[this.k_ind[1]]+=b[1]);
0==b[1]&&(this.brd[this.k_ind[0]]+=b[0]);if(0==b[0]||0==b[1]){for(a=0;a<this.bs;a++)this.brd[this.index(0,a)]=0,this.brd[this.index(1,a)]=0;return!0}return!1};c.genMoves=function(a){var b=[],e,c;this.makeTemp();for(c=0;c<this.bs;c++)if(e=this.index(a,c),0!=this.brd[e])if(this.fill(this.tmp),r=this.tmp.moveStep(a,c))b.push([c]);else if(e=this.tmp.genMoves(a),0==e.length)b.push([c]);else{var d;for(d=0;d<e.length;d++)b.push([c].concat(e[d]))}return b};c.fillBoard=function(a){var b;for(b=0;b<this.bs;b++)this.brd[b]=
a,this.brd[b+this.bs+1]=a;this.brd[this.bs]=0;this.brd[2*this.bs+1]=0};c.clone=function(a){a.makeBoard(this.bs);this.fill(a)};c.makeTemp=function(){this.is_tmp||(this.is_tmp=!0,this.tmp=new KalahBoard,this.tmp.makeBoard(this.bs))};c.makeBoard=function(a){this.brd=[];this.bs=a;var b;for(b=0;b<2*(a+1);b++)this.brd.push(0);this.k_ind=[a,2*a+1]};c.index=function(a,b){return b+a*(this.bs+1)};c.getCell=function(a,b){return this.brd[this.index(a,b)]};c.side=function(a){return a<=this.bs?0:1};c.moveStep=
function(a,b){for(var e=this.index(a,b),c=this.k_ind[1-a],d=2*this.bs+1;;){var f=this.brd[e];for(this.brd[e]=0;0<f;)e=e==d?0:e+1,e!=c&&(this.brd[e]++,f--);if(this.side(e)!=a)return!0;if(e==this.k_ind[a])return!1;if(1==this.brd[e])return e=2*this.bs-e,this.brd[this.k_ind[a]]+=this.brd[e],this.brd[e]=0,!0}};c.getKala=function(a){return this.brd[this.k_ind[a]]};return d}(),KalahAInterface=function(){var d=function(c){this.bs=c;this.boards=[];this.inf_plus=1E5;this.inf_minus=-1E5;this.cnt_rates=0};proto=
d.prototype;proto.newBoard=function(){if(0!=this.boards.length)return this.boards.pop();var c=new KalahBoard;c.makeBoard(this.bs);return c};proto.reuse=function(c){this.boards.push(c)};proto.filtered_moves=function(c,a){return c.genMoves(a)};proto.rate=function(c,a){var b=1-a;this.cnt_rates++;return c.getKala(a)-c.getKala(b)};return d}(),AlphaBeta=function(){var d=function(){},c=d.prototype;c.ABPrun=function(a,b,c,g,d,f){var h={rate:0};if(this.time_check&&(new Date).getTime()>this.plan)return this.overtaim=
!0,h;this.cnt++;var q=1-c;h.best_moves=[];if(0>=f||a.gameOver())return h.rate=b.rate(a,c),h.best_moves=[],h;var k=b.newBoard(),l=b.inf_minus,p=b.filtered_moves(a,c),l=g;for(g=0;g<p.length;g++){if(this.time_check&&(new Date).getTime()>this.plan)return this.overtaim=!0,h;m=p[g];a.fill(k);k.doMove(c,m);r=k.gameOver()?b.rate(k,c):-this.ABPrun(k,b,q,-d,-l,f-1).rate;r>l&&(l=r)}b.reuse(k);h.rate=l;h.best_moves=m;return h};c.bestMoves=function(a,b,c,g){this.cnt=0;var d=1-c;if(a.gameOver())return[];var f=
b.newBoard(),h=b.inf_minus,q=b.filtered_moves(a,c),h=b.inf_minus,k=[],l;for(l=0;l<q.length;l++){var p=q[l];a.fill(f);f.doMove(c,p);r=f.gameOver()?b.rate(f,c):-this.ABPrun(f,b,d,b.inf_minus,b.inf_plus,g-1).rate;r>h&&(k=[],h=r);r==h&&k.push(p)}return k};c.move=function(a,b,c,g){this.overtaim=this.time_check=!1;b.cnt_rates=0;a=this.bestMoves(a,b,c,g);b=Math.floor(Math.random()*a.length);return a[b]};c.move_time1=function(a,b,c,g,d){for(this.time_check=!0;;){b.cnt_rates=0;this.plan=(new Date).getTime()+
d;this.overtaim=!1;var f=this.bestMoves(a,b,c,g);if(this.overtaim)g--;else return a=Math.floor(Math.random()*f.length),this.real_depth=g,f[a]}};c.move_time=function(a,b,c,d,n){this.time_check=!0;d=2;var f=0,h="";for(this.plan=(new Date).getTime()+n;;){b.cnt_rates=0;this.overtaim=!1;n=this.bestMoves(a,b,c,d);if(this.overtaim)return b.cnt_rates=f,h;f=Math.floor(Math.random()*n.length);this.real_depth=d;h=n[f];f=b.cnt_rates;this.real_depth=d;d++}};return d}(),KalahView_vanill=function(){var d=function(){this.holes=
[[],[]];this.man=[];this.view_board=""},c=d.prototype;c.tag=function(a){return Utils.tag(a)};c.makeBoard=function(a){this.holes=[[],[]];this.man=[];this.bs=a;this.view_board=Utils.table(1,3);var b={valign:"middle","text-align":"center",width:60,"font-size":"xx-large","font-weight":"bold"};this.man[1]=this.view_board.cells[0][0].css(b);var c=this.view_board.cells[0][1];this.man[0]=this.view_board.cells[0][2].css(b);b=Utils.table(4,a).appendTo(c);styleHdr={valign:"middle","text-align":"center",width:60,
height:30};styleBody={valign:"middle","vertical-align":"middle","text-align":"center",width:60,height:60,"font-size":"xx-large","border-top":"solid","border-bottom":"solid","border-left":"solid","border-right":"solid",border:"1px solid black","border-radius":"20px",padding:"0px"};for(c=0;c<a;c++){var d;d=b.cells[1][c];d.css(styleBody);this.holes[1][a-c-1]=d;d=b.cells[2][c];d.css(styleBody);this.holes[0][c]=d;b.cells[3][c].css(styleHdr).html(a-c);b.cells[0][c].css(styleHdr).html(c+1)}};c.click=function(a){var b;
for(b=0;b<this.bs;b++)this.holes[1][b].click(function(b){return function(){a(1,b)}}(b)),this.holes[0][b].click(function(b){return function(){a(0,b)}}(b))};c.draw=function(a){var b;for(b=0;b<this.bs;b++)this.holes[1][b].html(a.getCell(1,b)),this.holes[0][b].html(a.getCell(0,b));this.man[0].html(a.getKala(0));this.man[1].html(a.getKala(1))};return d}(),KalahGame_vanill=function(){var d=function(){},c=d.prototype;c.tag=function(a){return Utils.tag(a)};c.btn=function(a,b){var c=this;return this.tag("button").html(a).click(function(){b.apply(c)})};
c.startGame=function(){this.ng(6,6)};c.log_move=function(a,b){var c=new KalahView_vanill;c.makeBoard(this.bs);c.draw(this.board);var d=this.tag("div");this.tag("div").html("\u0425\u043e\u0434 "+(0==a?"\u042e\u0433\u0430":"\u0421\u0435\u0432\u0435\u0440\u0430")+"  "+(this.bs-b)).appendTo(d);c.view_board.appendTo(d);this.hist_place.prepend(d)};c.ng=function(a,b){this.thinking=!1;this.bs=a;this.view=new KalahView_vanill;this.view.makeBoard(a);this.brd_place.html("");this.view.view_board.appendTo(this.brd_place);
this.board=new KalahBoard;this.board.makeBoard(a);this.board.fillBoard(a);this.view.draw(this.board);this.ki=new KalahAInterface(6);this.ab=new AlphaBeta;var c=this;this.view.click(function(a,b){c.onclick(a,b)});this.hist_place.html("")};c.msg=function(a){this.alert_place.html(a)};c.init=function(a){a.html("");this.ctrl_place=this.tag("div").appendTo(a);this.btn("\u0418\u0433\u0440\u0430\u0442\u044c",this.startGame).css({"font-size":"x-large"}).appendTo(this.ctrl_place);this.brd_place=this.tag("div").appendTo(a);
this.alert_place=this.tag("div").appendTo(a);this.hist_place=this.tag("div").appendTo(a)};c.onclick=function(a,b){if(this.thinking)this.msg("\u0441\u0435\u0432\u0435\u0440 \u0434\u0443\u043c\u0430\u0435\u0442, \u0436\u0434\u0438\u0442\u0435");else if(1==a)this.msg("\u0412\u044b \u0438\u0433\u0440\u0430\u0435\u0442\u0435 \u0437\u0430 \u042e\u0433");else if(0==this.board.getCell(0,b))this.msg("\u0412 \u043b\u0443\u043d\u043a\u0435 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435\u0442!");else{this.log_move(0,
b);var c=this.board.moveStep(0,b);this.view.draw(this.board);if(this.board.gameOver())this.msg("\u0418\u0433\u0440\u0430 \u043e\u043a\u043e\u043d\u0447\u0435\u043d\u0430"),this.view.draw(this.board);else if(c){var d=this;this.msg("\u0434\u0443\u043c\u0430\u044e....");this.thinking=!0;setTimeout(function(){d.nord_move()},100)}else this.msg("\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0439\u0442\u0435!")}};c.nord_move=function(){var a;a=this.ab.move_time(this.board,this.ki,1,6,3E3);var b;for(b=
0;b<a.length;b++)this.log_move(1,a[b]),this.board.moveStep(1,a[b]);this.board.gameOver()&&this.msg("\u0418\u0433\u0440\u0430 \u043e\u043a\u043e\u043d\u0447\u0435\u043d\u0430");this.msg("");this.view.draw(this.board);this.thinking=!1;this.msg("\u0413\u043b\u0443\u0431\u0438\u043d\u0430 \u0430\u043d\u0430\u043b\u0438\u0437\u0430 "+this.ab.real_depth+" ("+this.ki.cnt_rates+" \u043f\u043e\u0437\u0438\u0446\u0438\u0439)")};return d}();
</script>

<script>
$(document).ready(function(){
        var g=new KalahGame_vanill();
        g.init(Utils.byId('root'));
 });
</script>

</head>
<body >
<div id="root"></div>
</body>
 
</html>